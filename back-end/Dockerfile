FROM node:lts

WORKDIR /back-end

ARG PORT
ARG NODE_ENV
ARG FRONTEND_HOST
ARG PASSPORT_CALLBACK_HOST
ARG DATABASE_URL
ARG REDIS_URL
ARG FACEBOOK_APP_ID
ARG FACEBOOK_APP_SECRET
ARG GOOGLE_CLIENT_ID
ARG GOOGLE_CLIENT_SECRET
ARG FIREBASE_API_KEY
ARG FIREBASE_AUTH_DOMAIN
ARG FIREBASE_DATABASE_URL
ARG FIREBASE_PROJECT_ID
ARG FIREBASE_STORAGE_BUCKET
ARG ALGOLIA_APPLICATION_ID
ARG ALGOLIA_API_KEY
ARG FINANCIAL_MODELING_PREP_API_KEY
ARG MAILGUN_API_KEY
ARG SENDGRID_API_KEY

COPY package.json package.json
COPY package-lock.json package-lock.json
COPY .flowconfig .flowconfig
COPY bin/ bin/

RUN npm i

COPY . .
RUN npm run build
RUN npx prisma generate

EXPOSE 4000
CMD npm start